# SARS-CoV-2_wastewater_NCAT

SARS-CoV-2 Epidemiology & Wastewater Surveillance at North Carolina Agricultural and Technical State University in 2021-2023

## See outputs

The scripts to create outputs and some input files are stored in the git repository itself.  The outputs they make, such as figures, are available as non-tracked attachements, see the releases page: [https://github.com/FodorLab/SARS-CoV-2_wastewater_NCAT/releases](https://github.com/FodorLab/SARS-CoV-2_wastewater_NCAT/releases). These can be downloaded to browse locally.

## Project File Structure

This project is designed to be compatible with specific software: Code Ocean and BioLockJ.

### Code Ocean

This project is designed to work with [Code Ocean](https://codeocean.com/).

See corresponding Code Ocean Capsule ["SARS-CoV-2_wastewater_NCAT"](https://codeocean.com/capsule/8844928/tree).

To work with the Code Ocean platform, the top level directories are named to match the 4 "Core Files" folders:

 * `metadata`
 * `environment`
 * `data`
 * `code` (pretty much everything is in here)
 
**metadata**
 
_This directory has the metadata.yml generated by Code Ocean.  For data describing samples (ie metadata) see **code/analysis/input/meta**._
 
**environment**

_This directory has the files to create the environment to run the pipeline._  

This includes: 

  * the `Dockerfile` that is automatically generated by Code Ocean based on information entered in the Environment IDE. It is important to NOT EDIT this file except through the Code Ocean IDE.
  * the `postInstall` script that installs anything else required.
  * the `alternatives/docker/Dockerfile` which can be used locally to create a container for running the pipeline on a local machine.
  
_Note:_ Both Code Ocean and BioLockJ use docker containers.  When running on Code Ocean, the docker container is managed by Code Ocean which uses the container defined in `/environment/Dockerfile`, and BioLockJ runs the pipeline inside that container and does not know that it is operating inside a container.  If you choose to run the pipeline on a local machine you may choose to have BioLockJ manage docker containers locally, using the container(s) available thru the docker hub or defined in `/environment/alternatives/Dockerfile`. BioLockJ could also be used to run the pipeline on a local machine as long the required software is installed.  

To run locally, you will need the following:

R (version 4.4.0 was used)

Most modules require following R packages:
  * tidyr
  * dplyr
  * ggplot2
  * ggrepel
  * lubridate
  * Hmisc

Rendering markdowns requires:
  * markdown

**data**

_Code Ocean will store and manage large files that should not be commited in git. Here, we have the folder for reference, and the README in that folder will have instructions on how to acquire any data needed to run the analysis that is not directly commited in git._


**code**

_This is the main folder.  This is the folder that Code Ocean expects all other git-committed files to be in._


For a compelling argument in favor of using Code Ocean, check out the 2021 editorial ["Promoting reproducibility with Code Ocean"](https://genomebiology.biomedcentral.com/articles/10.1186/s13059-021-02299-x) by Barbara Cheifet, an editor at _Genome Biology_.

### BioLockJ

[BioLockJ](https://biolockj-dev-team.github.io/BioLockJ/) is a pipeline manager. It takes a set of inputs and scripts and generates a new project space with a set structure. To run the pipeline, use the following command on a system where these files are stored and BioLockJ is installed:

`biolockj covid_wastewater_NCAT.config`

The project structure here matches the structure that BioLockJ creates, so relative file paths that work in a given run of the pipeline also work in this repository directly.  Thus, the `code` folder is equivalent to the top level of a pipeline run folder. 

Note that module folders have numbers but these numbers are arbitrary. It keeps them in an intuitive order, but the numbers are not guaranteed to be the same in a given run.

For any given script, its working directory in a run will be `<pipeline>/<module>/<subdir>`; that is **a directory one level down from the module directory**. For example: 

 * project file: `code/analysis/03_Dorms-and-methods/script/Dorm-to-dorm-correlations.Rmd`
 * becomes `covid_wastewater_NCAT_<date>/03_Dorms-and-methods/resources/Dorm-to-dorm-correlations.Rmd` in a given BioLockJ run.

BioLockJ can copy any specified input files into the `input` folder for the run.  For any inputs that are stored in git, it is convenient to store them in `analysis/input` to mach the relative files paths of a run.

For more details about BioLockJ, see the [BioLockJ User Guide](https://biolockj-dev-team.github.io/BioLockJ/) and the README file in the `analysis` folder.

## Publication info

Eventually, this project will be published in a scientific journal.  Details will posted here when they become available.

Working Title: SARS-CoV-2 Epidemiology & Wastewater Surveillance at North Carolina Agricultural and Technical State University in 2021-2023
Lead author: Shilpi Bhatia


